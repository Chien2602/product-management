extends ../defaults/defaultClient

block main
    link(rel="stylesheet", href="/css/client/product.css")
    .container.my-3
        .row
            .col-12
                h1.text-center.mb-4 Danh sách sản phẩm

        //- Bộ lọc sản phẩm
        .row.mb-4.filter-section
            .col-md-4
                label(for="filter-name" class="form-label") Tìm kiếm theo tên
                input#filter-name.form-control(type="text" placeholder="Nhập tên sản phẩm")
            .col-md-4
                label(for="filter-price" class="form-label") Khoảng giá
                select#filter-price.form-select
                    option(value="all") -- Chọn khoảng giá --
                    option(value="0-50") Dưới $50
                    option(value="50-100") $50 - $100
                    option(value="100-200") $100 - $200
                    option(value="200+") Trên $200
            .col-md-4
                label(for="filter-discount" class="form-label") Mức giảm giá
                select#filter-discount.form-select
                    option(value="all") -- Chọn mức giảm giá --
                    option(value="10") Từ 10% trở lên
                    option(value="20") Từ 20% trở lên
                    option(value="30") Từ 30% trở lên

        //- Danh sách sản phẩm
        .row#product-list
            each item in products
                .col-4.mb-3
                    .product-item
                        .inner-image.position-relative
                            img(src=item.thumbnail, alt=item.title)
                            //- Nút trái tim
                            button.favorite-btn(type="button" data-id=item.id)
                                i.fa.fa-heart
                        .inner-content
                            h3.inner-title= item.title
                            .inner-price-new= "$" + item.priceNew
                            .inner-price-old= "$" + item.price
                            .inner-discount= item.discountPercentage + "%"

                        button.btn.btn-primary
                            i.fa.fa-cart-plus
                            | Add to Cart

    script(src="https://cdn.jsdelivr.net/npm/axios/dist/axios.min.js")
    script(src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js")
    script.
        // Bộ lọc sản phẩm và xử lý yêu thích
        document.addEventListener('DOMContentLoaded', () => {
            const productList = document.getElementById('product-list');
            const filterName = document.getElementById('filter-name');
            const filterPrice = document.getElementById('filter-price');
            const filterDiscount = document.getElementById('filter-discount');

            const favoriteProducts = new Set(); // Lưu các sản phẩm yêu thích

            // Hàm lọc sản phẩm
            const filterProducts = () => {
                const nameValue = filterName.value.toLowerCase();
                const priceValue = filterPrice.value;
                const discountValue = filterDiscount.value;

                // Lọc sản phẩm
                const filteredProducts = products.filter(item => {
                    // Tìm kiếm theo tên
                    const matchesName = item.title.toLowerCase().includes(nameValue);

                    // Lọc theo giá
                    let matchesPrice = true;
                    if (priceValue !== 'all') {
                        const [min, max] = priceValue.split('-').map(Number);
                        const price = parseFloat(item.priceNew);
                        matchesPrice = max
                            ? price >= min && price <= max
                            : price >= min; // Trường hợp "Trên $200"
                    }

                    // Lọc theo mức giảm giá
                    let matchesDiscount = true;
                    if (discountValue !== 'all') {
                        const minDiscount = parseFloat(discountValue);
                        matchesDiscount = item.discountPercentage >= minDiscount;
                    }

                    return matchesName && matchesPrice && matchesDiscount;
                });

                // Hiển thị danh sách sản phẩm
                productList.innerHTML = filteredProducts.map(item => `
                    <div class="col-4 mb-3">
                        <div class="product-item">
                            <div class="inner-image position-relative">
                                <img src="${item.thumbnail}" alt="${item.title}" />
                                <button class="favorite-btn" type="button" data-id="${item.id}">
                                    <i class="fa fa-heart ${favoriteProducts.has(item.id) ? 'active' : ''}"></i>
                                </button>
                            </div>
                            <div class="inner-content">
                                <h3 class="inner-title">${item.title}</h3>
                                <div class="inner-price-new">$${item.priceNew}</div>
                                <div class="inner-price-old">$${item.price}</div>
                                <div class="inner-discount">${item.discountPercentage}%</div>
                            </div>
                            <button class="btn btn-primary">
                                <i class="fa fa-cart-plus"></i> Add to Cart
                            </button>
                        </div>
                    </div>
                `).join('');

                // Gán sự kiện cho nút trái tim
                document.querySelectorAll('.favorite-btn').forEach(btn => {
                    btn.addEventListener('click', () => {
                        const productId = btn.getAttribute('data-id');
                        const icon = btn.querySelector('.fa-heart');
                        if (favoriteProducts.has(productId)) {
                            favoriteProducts.delete(productId);
                            icon.classList.remove('active');
                        } else {
                            favoriteProducts.add(productId);
                            icon.classList.add('active');
                        }
                    });
                });
            };

            // Gán sự kiện thay đổi
            [filterName, filterPrice, filterDiscount].forEach(input =>
                input.addEventListener('input', filterProducts)
            );
        });
    style.
        .filter-section {
            background-color: #f9f9f9;
            padding: 15px;
            border-radius: 8px;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
            margin-bottom: 20px;
        }

        .product-item .favorite-btn {
            position: absolute;
            top: 10px;
            right: 10px;
            background: none;
            border: none;
            cursor: pointer;
            color: #ccc;
            font-size: 1.5rem;
        }

        .product-item .favorite-btn .fa-heart.active {
            color: red;
        }

        .product-item:hover .favorite-btn {
            color: #999;
        }

        .product-item .favorite-btn:focus {
            outline: none;
        }

